#                _
#   ___ _   _ ___| |_ ___ _ __ ___
#  / __| | | / __| __/ _ \ _ ` _ \
#  \__ \ |_| \__ \ ||  __/ | | | | |
#  |___/\__, |___/\__\___|_| |_| |_|
#       |___/
#

system:
  # Type
  module_type: cgra.fabric.Cgra_Hw
  # IO
  input_ports: [i1,i2,i3,i4]
  output_ports: [o1]
  # Data Information
  data_word_width: 32
  # Host bus information.
  host_word_width: 32 # Fixed, for now.
  # Test memory system.
  num_test_data_memory_words: 32786
  test_data_memory_buffer_depth: 4

#     ____             _
#    |  _ \ ___  _   _| |_ ___ _ __
#    | |_) / _ \| | | | __/ _ \ __|
#    |  _ < (_) | |_| | ||  __/ |
#    |_| \_\___/ \__,_|\__\___|_|
#

routers:
  default: &default_router
    module_type: cgra.fabric.router
    # Input / Output
    input_ports: [north,south,east,west,northeast,northwest,southeast,southwest]
    output_ports: [north,south,east,west,northeast,northwest,southeast,southwest]
    config_input_port: north
    config_output_port: south
    # Data Word Width use global or not
    use_global: true
    # Decomposability
    isDecomposed: false
    decomposer: 1
    # Protocol (Ready = Dynamic, Non-Ready = Static)
    protocol: Data
    # Shared
    isShared: false
    back_pressure_fifo_depth: 2
    shared_slot_size: 32
    # Interconnection between Subent [Optional]
    # like: inter_subnet_connection: [south_1 <-> north_0,northeast_0 <-> east _1]

  router_1: &router_1
    <<: *default_router
    config_input_port: west
    config_output_port: southeast

  router_2: &router_2
    <<: *default_router
    config_input_port: north
    config_output_port: east


  router_3: &router_3
    <<: *default_router
    config_input_port: west
    config_output_port: southwest


  router_4: &router_4
    <<: *default_router
    config_input_port: east
    config_output_port: southeast

  router_5: &router_5
    <<: *default_router
    config_input_port: northwest
    config_output_port: west

  router_6: &router_6
    <<: *default_router
    config_input_port: northwest
    config_output_port: southwest

  router_7: &router_7
    <<: *default_router
    config_input_port: east
    config_output_port: south

  router_8: &router_8
    <<: *default_router
    config_input_port: northwest
    config_output_port: west

  router_9: &router_9
    <<: *default_router
    config_input_port: northwest
    config_output_port: west

#   ____           _ _           _           _   ____  _____
#  |  _ \  ___  __| (_) ___ __ _| |_ ___  __| | |  _ \| ____|
#  | | | |/ _ \/ _` | |/ __/ _` | __/ _ \/ _` | | |_) |  _|
#  | |_| |  __/ (_| | | (_| (_| | ||  __/ (_| | |  __/| |___
#  |____/ \___|\__,_|_|\___\__,_|\__\___|\__,_| |_|   |_____|
#

dedicated_pes:
  default_dedicated_pe: &default_dedicated_pe
    module_type: cgra.fabric.dedicated_pe
    use_global: true
    # Config
    config_input_port: northwest
    config_output_port: southeast
    # Input Output Capability
    input_ports: [northwest,northeast,southwest,southeast]
    output_ports: [southeast]
    # Decomposability
    isDecomposed: false
    decomposer: 1
    # Protocol
    protocol: DataValidReady
    # Control
    has_metaReuse: {valid: false,num_reuse: 4} #TODO: Not yet implemented
    # Shared Instruction
    isShared: false
    shared_slot_size: 32
    register_file_size: 2
    # Datapath
    delay_fifo_depth: 4 # Delay Pipe when protocol don't has Ready; Delay FIFO when protocol has Ready
    instructions: [Add,Mul]
    output_select_mode: Universal #[ Individual ]

  dedicated_pe_1: &dedicated_pe_1
    <<: *default_dedicated_pe
    instructions: [Add]

  dedicated_pe_2: &dedicated_pe_2
    <<: *default_dedicated_pe
    config_input_port: northeast
    instructions: [Add]

  dedicated_pe_3: &dedicated_pe_3
    <<: *default_dedicated_pe
    isShared: true
    shared_slot_size: 4
    register_file_size: 2
    instructions: [Add]

  dedicated_pe_4: &dedicated_pe_4
    <<: *default_dedicated_pe
    config_input_port: northeast
    instructions: [Mul]

#   _____                 _
#  |_   _|__  _ __   ___ | | ___   __ _ _   _
#    | |/ _ \| '_ \ / _ \| |/ _ \ / _` | | | |
#    | | (_) | |_) | (_) | | (_) | (_| | |_| |
#    |_|\___/| .__/ \___/|_|\___/ \__, |\__, |
#            |_|                  |___/ |___/

topology: [
  #                  ------ Vector Port Connection ------
  # Input -> Vector Port
  this.i1 -> router_1.west,
  this.i2 -> router_4.west,
  this.i3 ->router_2.north,
  this.i4 ->router_3.north,
  # Vector Port -> Output
  router_7.south -> this.o1,

  #                  ------ Router Connection ------
  # Router 1 Connection
  router_1.east<->router_2.west,
  router_1.south<->router_4.north,
  router_1.southeast->dedicated_pe_1.northwest,
  # Router 2 Connection
  router_2.southwest->dedicated_pe_1.northeast,
  router_2.south<->router_5.north,
  router_2.southeast->dedicated_pe_2.northwest,
  router_2.east<->router_3.west,
  # Router 3 Connection
  router_3.southwest->dedicated_pe_2.northeast,
  router_3.south<->router_6.north,
  # Router 4 Connection
  router_4.east<->router_5.west,
  router_4.northeast->dedicated_pe_1.southwest,
  router_4.southeast->dedicated_pe_3.northwest,
  router_4.south<->router_7.north,
  # Router 5 Connection
  router_5.northwest<->dedicated_pe_1.southeast,
  router_5.northeast->dedicated_pe_2.southwest,
  router_5.east<->router_6.west,
  router_5.southeast->dedicated_pe_4.northwest,
  router_5.southwest->dedicated_pe_3.northeast,
  router_5.south<->router_8.north,
  # Router 6 Connection
  router_6.northwest<->dedicated_pe_2.southeast,
  router_6.southwest->dedicated_pe_4.northeast,
  router_6.south<->router_9.north,
  # Router 7 Connection
  router_7.northeast->dedicated_pe_3.southwest,
  router_7.east<->router_8.west,
  # Router 8 Connection
  router_8.northwest<->dedicated_pe_3.southeast,
  router_8.east<->router_9.west,
  router_8.northeast->dedicated_pe_4.southwest,
  # Router 9 Connection
  router_9.northwest<->dedicated_pe_4.southeast
]